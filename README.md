`finabm` : Financial ABMs
=========================

**See _Main results_ section for the core results described in the paper**

This repository contains implementations of some Agent Based Models,
such as Minority Game (MG) and $Game (DG), for studying financial markets
and related phenomena. It also contains specific analyses using these models.

Models are implemented in Python using Numpy and other related
packages for efficient numerical computing, so they are relatively fast.
General parts of the implementations are organized as a standalone Python
package `finabm`, installable with PIP directly from this repository
(instructions below).

Specific analyses are implemented either as simple Python scripts or using
[Quarto notebooks](https://quarto.org/),
which bundle together code, tables, figures and text narrative describing
the purpose of the analyses and the meaning of the obtained results.


## Repository structure

    ├── reports            <- directory with reports on the main results
    ├── finabm             <- Python package implementing ABMs
    ├── tests              <- automatic unit tests using `pytest`
    ├── README.md
    ├── environment.yaml   <- specification of Conda env
    └── pyproject.toml     <- metadata and build instructions for the 'finabm' package


## Setting up the environment

Below are instructions for setting up an environment for replicating
the results. Here we use Conda for handling Python virtual environments,
but with some additional tweaking any other approach
(e.g. standard Python venv) should also work.

```bash
# clone the repository from Github and enter it
git clone https://github.com/sztal/finabm
cd finabm

# Create Conda env
# By default it is named 'finabm'
# but the name can be changed in 'environment.yaml'
conda env create -f environment.yaml
# Activate the environment
conda activate finabm
# Install 'finabm' package
pip install .
# Or install in 'editable' mode if needed
pip install --editable .
```


## Installing `finabm` package from Github

For the provided ABMs in other applications/analyses, the most convenient
thing to do is to install `finabm` package as a standalone Python package
directly from the Github repository.

```bash
pip install git+ssh://git@github.com/sztal/finabm.git
```


## Main results | `reports > xg-main`

The main results produced with the model combining $Game
(technical analysis traders) with fundamental analysis traders
and the $X$ factor modeling inherent variability of an asset's pricing
(i.e. driven by an erratic behavior of the CEO) are computed and presented
in the `reports > xg-main` folder. In particular, there are 3 scripts:

1. `make_data.py` - runs ABM simulations to generated data presented
in the paper.
2. `make_fig1.py` - uses data generated by `make_data.py` script to
draw figure 1 from the paper
(the one presenting examples of price trajectories).
3. `make_fig2.py` - use data generated by `make_data.py` script to
draw figure 2 from the paper
(the one presenting price quantiles and theoretical $\Delta$-bounds).

### Reproduction

```bash
## RUN SIMULATIONS AND GENERATE DATA
## THE COMMANDS ASSUME A BASH-LIKE UNIX SHELL
cd reports/xg-main

## 1. Generate raw data for 'make_fig1.py'
python make_data.py -N1001 -F750 -M10 -S5 -L500 -T5000 -R100 --jobs=12
## Use '--jobs=x' to specify the number of jobs used for parallelization
## of the computations

## 2. Generate 'figs/fig1.png'
python make_fig1.py

## 3. Generate quantile data for 'make_fig2.py'
## THIS MAY TAKE A LONG TIME (several hours or more)
for F in 550 750 950
do python make_data.py -N1001 -F$F -M10 -S5 -L500 -T10000 -R10000 --quantiles --jobs=12
done

## 4. Generate 'figs/fig2.png'
python make_fig2.py
```


## Auxiliary reports

There are two auxiliary reports, `mg-basic` and `mg-core`, used for
validating the correctness of the minority game (MG) implementation
underlying the implementation of the $Game.


## Tests

Additionally, the correctness of the implementations of the
Minority Game and Dollar Game are tested against actual simple scenarios
calculated by hand. This is implemented as automated tests using `pytest`.

```bash
# TO RUN THE TESTS JUST INVOKE THE FILLOWING COMMAND
# IN THE ROOT DIRECTORY OF THE REPOSITORY
pytest
```


## Requirements

The code is known to run for Python3.10+ and should work for any OS.
Other dependencies are installed either when installing the `finabm` package
or when setting up a Conda environment from the `environment.yaml` file,
which also lists all dependencies.


## Usage

Here is a simple example of how to run the proposed financial game
mixing technical analysis traders ($Game) and fundamental analysis
traders.

Details concerning attributes and parameters of functions, classes and
methods are provided in appropriate docstrings.

```python
# IMPORT GAME CLASSES
from finabm import Dollar, Fundamental, FinancialGame

# DEFINE MAIN PARAMETERS
M = 10
S = 5
X = .001

xg = FinancialGame(
    Dollar(251, M, S),
    Fundamental(750, M, X)
)
## RUN FOR 1000 STEPS
xg.run(1000)
```
